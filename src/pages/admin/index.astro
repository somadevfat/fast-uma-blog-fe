---
export const prerender = false;
import AdminLayout from "../../layouts/AdminLayout.astro";
import { API_BASE_URL } from "../../lib/api";

const response = await fetch(`${API_BASE_URL}/posts`);
const { data: posts = [] } = await response.json();
---

<AdminLayout title="記事管理">
  <div
    class="flex justify-between items-center mb-8 border-b border-wiki-border pb-4"
  >
    <div>
      <h1 class="!m-0 !border-0 text-2xl font-bold">記事管理一覧</h1>
      <p class="text-xs text-gray-500 mt-1">
        Wiki記事の作成、編集、公開状態の管理を行います。
      </p>
    </div>
    <a
      href="/admin/edit/new"
      class="bg-primary text-white font-bold px-4 py-2 text-sm shadow-sm hover:opacity-90 transition-opacity"
    >
      [+] 新規記事作成
    </a>
  </div>

  <div class="bg-white border border-wiki-border shadow-sm overflow-hidden">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-wiki-header-bg">
          <th
            class="px-4 py-3 text-left text-xs font-bold border-b border-wiki-border"
            >タイトル / スラッグ</th
          >
          <th
            class="px-4 py-3 text-left text-xs font-bold border-b border-wiki-border"
            >ステータス</th
          >
          <th
            class="px-4 py-3 text-left text-xs font-bold border-b border-wiki-border"
            >作成日</th
          >
          <th
            class="px-4 py-3 text-right text-xs font-bold border-b border-wiki-border"
            >操作</th
          >
        </tr>
      </thead>
      <tbody>
        {
          posts.length === 0 ? (
            <tr>
              <td
                colspan="4"
                class="px-4 py-12 text-center text-gray-400 italic text-sm"
              >
                記事が見つかりません。「新規記事作成」から最初のページを作成しましょう。
              </td>
            </tr>
          ) : (
            posts.map((post: any) => (
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-4 py-4 border-b border-wiki-border">
                  <div class="font-bold text-sm">{post.title}</div>
                  <div class="text-[10px] font-mono text-gray-400">
                    /{post.slug}
                  </div>
                </td>
                <td class="px-4 py-4 border-b border-wiki-border">
                  <span
                    class={`px-2 py-0.5 text-[10px] font-bold border ${post.published ? "bg-green-50 text-green-700 border-green-200" : "bg-yellow-50 text-yellow-700 border-yellow-200"}`}
                  >
                    {post.published ? "公開中" : "下書き"}
                  </span>
                </td>
                <td class="px-4 py-4 border-b border-wiki-border text-[11px] text-gray-500">
                  {new Date(post.createdAt).toLocaleDateString("ja-JP")}
                </td>
                <td class="px-4 py-4 border-b border-wiki-border text-right">
                  <a
                    href={`/admin/edit/${post.slug}`}
                    class="text-xs font-bold text-primary hover:underline"
                  >
                    編集
                  </a>
                </td>
              </tr>
            ))
          )
        }
      </tbody>
    </table>
  </div>

  <div class="mt-8 sidebar-box !bg-yellow-50 !border-yellow-200">
    <div class="sidebar-title !border-yellow-400 !text-yellow-800">ヒント</div>
    <ul class="text-[11px] text-yellow-800 space-y-1">
      <li>・スラッグはURLの一部になります。英数字とハイフンを推奨します。</li>
      <li>・下書き保存した記事は公開Wikiには表示されません。</li>
    </ul>
  </div>
</AdminLayout>
