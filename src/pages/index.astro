---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import ViewCounter from '../features/interactions/components/ViewCounter';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
).slice(0, 3);

const projects = (await getCollection('portfolio')).sort(
  (a, b) => a.data.sortOrder - b.data.sortOrder
).slice(0, 4);
---

<BaseLayout title="UMA TECH BLOG | fanda-dev.com">
  <div class="space-y-32 pt-12 pb-20">
    <!-- Blog Section -->
    <section>
      <div class="flex justify-between items-end mb-12">
        <div>
          <h2 class="text-xs font-black uppercase tracking-[0.3em] text-accent mb-4">Latest</h2>
          <h3 class="text-4xl font-black tracking-tight">最新の投稿</h3>
        </div>
        <a href="/blog" class="group flex items-center gap-2 text-sm font-black text-muted hover:text-foreground transition-colors">
          すべて見る
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
      <div class="grid gap-6">
        {posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="group glass p-8 rounded-3xl flex flex-col md:flex-row md:items-center justify-between gap-6 hover:border-accent/30 transition-all duration-500">
            <div class="max-w-2xl">
              <h4 class="text-2xl font-black mb-2 group-hover:text-gradient transition-all">{post.data.title}</h4>
              <p class="text-muted line-clamp-1 font-medium">{post.data.description}</p>
            </div>
            <div class="flex items-center gap-6">
              <time class="text-xs font-black text-muted uppercase tracking-widest whitespace-nowrap" datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString('ja-JP')}
              </time>
              <div class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center group-hover:bg-accent transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    </section>

    <!-- Portfolio Section -->
    <section>
      <div class="flex justify-between items-end mb-12">
        <div>
          <h2 class="text-xs font-black uppercase tracking-[0.3em] text-accent-secondary mb-4">Work</h2>
          <h3 class="text-4xl font-black tracking-tight">制作物</h3>
        </div>
        <a href="/portfolio" class="group flex items-center gap-2 text-sm font-black text-muted hover:text-foreground transition-colors">
          一覧を見る
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {projects.map((project) => (
          <a href="/portfolio" class="group glass rounded-3xl overflow-hidden hover:border-accent-secondary/30 transition-all duration-500">
            <div class="aspect-video bg-white/5 flex items-center justify-center relative overflow-hidden">
               <div class="absolute inset-0 bg-gradient-to-br from-accent/5 to-accent-secondary/5 group-hover:opacity-100 opacity-50 transition-opacity"></div>
               <span class="text-2xl font-black text-white/10 uppercase tracking-tighter group-hover:scale-110 transition-transform duration-700 italic">
                 {project.data.title}
               </span>
            </div>
            <div class="p-8">
              <h4 class="text-xl font-black mb-2 group-hover:text-accent-secondary transition-colors">{project.data.title}</h4>
              <p class="text-muted text-sm line-clamp-2 leading-relaxed font-medium">{project.data.description}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

    <!-- Home Page Stats -->
    <section class="flex justify-center pt-20">
      <div class="inline-flex items-center gap-4 px-6 py-3 glass rounded-full border-white/5">
        <span class="text-[10px] font-black uppercase tracking-[0.2em] text-muted">Page Visitors</span>
        <ViewCounter client:load slug="home" />
      </div>
    </section>
  </div>
</BaseLayout>